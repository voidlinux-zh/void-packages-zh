# Template file for 'xtify'
pkgname=xtify
version=2.7.2
revision=1
makedepends="pnpm nodejs sqlite tar make python3 python3-setuptools"
short_desc="a music player forked from YesPlayMusic"
maintainer="madoka773 <valigarmanda55@gmail.com>"
license="MIT"
homepage="https://github.com/Sherlockouo/music"
distfiles="https://github.com/Sherlockouo/music/archive/${version}.tar.gz"
checksum=6aca34c10cf3564b35095eb156ae5886b5323aa493ff6105f72b94947985f19e

pre_build() {
	cp .env.example .env
	cp packages/server/.env.example packages/server/.env
}

do_build() {
	pnpm i
	pnpm package
}

do_install() {
	vmkdir /opt/${pkgname}
	vcopy packages/desktop/release/linux-unpacked/* /opt/${pkgname}
	vinstall "${FILESDIR}/xtify.desktop" 644 usr/share/applications
	for _icons in 16x16 24x24 32x32 64x64 256x256 512x512;do
		vinstall "packages/desktop/build/icons/${_icons}.png" 644 \
			"usr/share/icons/hicolor/${_icons}/apps" ${pkgname}.png
	done
	vmkdir /usr/bin
	ln -svf /opt/${pkgname}/desktop ${DESTDIR}/usr/bin/xtify
	vlicense LICENSE
}
